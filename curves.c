// curves.c
// Minimal secp256k1 definition compatible with your bignum.h (using .val field)

#include "bignum.h"
#include "ecdsa.h"
#include "curves.h"

// Big-endian 32-byte constants

static const uint8_t secp256k1_prime_be[32] = {
    0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
    0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
    0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xfe,
    0xff,0xff,0xfc,0x2f,0x00,0x00,0x00,0x00
};

static const uint8_t secp256k1_order_be[32] = {
    0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,
    0xff,0xff,0xff,0xff,0xfe,0xba,0xae,0xdc,
    0xe6,0xaf,0x48,0xa0,0x3b,0xbf,0xd2,0x5e,
    0x8c,0xd0,0x36,0x41,0x41,0x00,0x00,0x00
};

static const uint8_t secp256k1_Gx_be[32] = {
    0x79,0xbe,0x66,0x7e,0xf9,0xdc,0xbb,0xac,
    0x55,0xa0,0x62,0x95,0xce,0x87,0x0b,0x07,
    0x02,0x9b,0xfc,0xdb,0x2d,0xce,0x28,0xd9,
    0x59,0xf2,0x81,0x5b,0x16,0xf8,0x17,0x98
};

static const uint8_t secp256k1_Gy_be[32] = {
    0x48,0x3a,0xda,0x77,0x26,0xa3,0xc4,0x65,
    0x5d,0xa4,0xfb,0xfc,0x0e,0x11,0x08,0xa8,
    0xfd,0x17,0xb4,0x48,0xa6,0x85,0x54,0x19,
    0x9c,0x47,0xd0,0x8f,0xfb,0x10,0xd4,0xb8
};

// Global instance of secp256k1
ecdsa_curve secp256k1 = {
    .prime = {{0}},
    .G = {
        .x = {{0}},
        .y = {{0}}
    },
    .order = {{0}},
    .order_half = {{0}}, // unused
    .a = 0,
    .b = {{7}}           // secp256k1: y^2 = x^3 + 7
#if USE_PRECOMPUTED_CP
    , .cp = {{{0}}}
#endif
};

// Must be called in main() before using secp256k1
void init_secp256k1(void) {
    bignum256 tmp;

    // Prime field p
    bn_read_be(secp256k1_prime_be, &tmp);
    bn_copy(&tmp, &secp256k1.prime);

    // Order n
    bn_read_be(secp256k1_order_be, &tmp);
    bn_copy(&tmp, &secp256k1.order);

    // Generator Gx
    bn_read_be(secp256k1_Gx_be, &tmp);
    bn_copy(&tmp, &secp256k1.G.x);

    // Generator Gy
    bn_read_be(secp256k1_Gy_be, &tmp);
    bn_copy(&tmp, &secp256k1.G.y);
}
